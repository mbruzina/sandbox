"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getSendMessagePlugin = exports.sendMessageMiddlewareOptions = exports.sendMessageMiddleware = void 0;
const util_hex_encoding_1 = require("@aws-sdk/util-hex-encoding");
const sendMessageMiddleware = (options) => (next) => async (args) => {
    const resp = await next({ ...args });
    const output = resp.output;
    const hash = new options.md5();
    hash.update(args.input.MessageBody || "");
    if (output.MD5OfMessageBody !== util_hex_encoding_1.toHex(await hash.digest())) {
        throw new Error("InvalidChecksumError");
    }
    return resp;
};
exports.sendMessageMiddleware = sendMessageMiddleware;
exports.sendMessageMiddlewareOptions = {
    step: "initialize",
    tags: ["VALIDATE_BODY_MD5"],
    name: "sendMessageMiddleware",
    override: true,
};
const getSendMessagePlugin = (config) => ({
    applyToStack: (clientStack) => {
        clientStack.add(exports.sendMessageMiddleware(config), exports.sendMessageMiddlewareOptions);
    },
});
exports.getSendMessagePlugin = getSendMessagePlugin;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VuZC1tZXNzYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlbmQtbWVzc2FnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFTQSxrRUFBbUQ7QUFRNUMsTUFBTSxxQkFBcUIsR0FDaEMsQ0FBQyxPQUEyQixFQUFrQyxFQUFFLENBQ2hFLENBQWdDLElBQW9DLEVBQWtDLEVBQUUsQ0FDeEcsS0FBSyxFQUFFLElBQXFDLEVBQTRDLEVBQUU7SUFDeEYsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDLENBQUM7SUFDckMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQTJCLENBQUM7SUFDaEQsTUFBTSxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUMxQyxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsS0FBSyx5QkFBSyxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7UUFDMUQsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0tBQ3pDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUM7QUFaUyxRQUFBLHFCQUFxQix5QkFZOUI7QUFFUyxRQUFBLDRCQUE0QixHQUE2QjtJQUNwRSxJQUFJLEVBQUUsWUFBWTtJQUNsQixJQUFJLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQztJQUMzQixJQUFJLEVBQUUsdUJBQXVCO0lBQzdCLFFBQVEsRUFBRSxJQUFJO0NBQ2YsQ0FBQztBQUVLLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxNQUEwQixFQUF1QixFQUFFLENBQUMsQ0FBQztJQUN4RixZQUFZLEVBQUUsQ0FBQyxXQUFXLEVBQUUsRUFBRTtRQUM1QixXQUFXLENBQUMsR0FBRyxDQUFDLDZCQUFxQixDQUFDLE1BQU0sQ0FBQyxFQUFFLG9DQUE0QixDQUFDLENBQUM7SUFDL0UsQ0FBQztDQUNGLENBQUMsQ0FBQztBQUpVLFFBQUEsb0JBQW9CLHdCQUk5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEluaXRpYWxpemVIYW5kbGVyLFxuICBJbml0aWFsaXplSGFuZGxlckFyZ3VtZW50cyxcbiAgSW5pdGlhbGl6ZUhhbmRsZXJPcHRpb25zLFxuICBJbml0aWFsaXplSGFuZGxlck91dHB1dCxcbiAgSW5pdGlhbGl6ZU1pZGRsZXdhcmUsXG4gIE1ldGFkYXRhQmVhcmVyLFxuICBQbHVnZ2FibGUsXG59IGZyb20gXCJAYXdzLXNkay90eXBlc1wiO1xuaW1wb3J0IHsgdG9IZXggfSBmcm9tIFwiQGF3cy1zZGsvdXRpbC1oZXgtZW5jb2RpbmdcIjtcblxuaW1wb3J0IHsgUHJldmlvdXNseVJlc29sdmVkIH0gZnJvbSBcIi4vY29uZmlndXJhdGlvbnNcIjtcblxuaW50ZXJmYWNlIFNlbmRNZXNzYWdlUmVzdWx0IHtcbiAgTUQ1T2ZNZXNzYWdlQm9keT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IHNlbmRNZXNzYWdlTWlkZGxld2FyZSA9XG4gIChvcHRpb25zOiBQcmV2aW91c2x5UmVzb2x2ZWQpOiBJbml0aWFsaXplTWlkZGxld2FyZTxhbnksIGFueT4gPT5cbiAgPE91dHB1dCBleHRlbmRzIE1ldGFkYXRhQmVhcmVyPihuZXh0OiBJbml0aWFsaXplSGFuZGxlcjxhbnksIE91dHB1dD4pOiBJbml0aWFsaXplSGFuZGxlcjxhbnksIE91dHB1dD4gPT5cbiAgYXN5bmMgKGFyZ3M6IEluaXRpYWxpemVIYW5kbGVyQXJndW1lbnRzPGFueT4pOiBQcm9taXNlPEluaXRpYWxpemVIYW5kbGVyT3V0cHV0PE91dHB1dD4+ID0+IHtcbiAgICBjb25zdCByZXNwID0gYXdhaXQgbmV4dCh7IC4uLmFyZ3MgfSk7XG4gICAgY29uc3Qgb3V0cHV0ID0gcmVzcC5vdXRwdXQgYXMgU2VuZE1lc3NhZ2VSZXN1bHQ7XG4gICAgY29uc3QgaGFzaCA9IG5ldyBvcHRpb25zLm1kNSgpO1xuICAgIGhhc2gudXBkYXRlKGFyZ3MuaW5wdXQuTWVzc2FnZUJvZHkgfHwgXCJcIik7XG4gICAgaWYgKG91dHB1dC5NRDVPZk1lc3NhZ2VCb2R5ICE9PSB0b0hleChhd2FpdCBoYXNoLmRpZ2VzdCgpKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZENoZWNrc3VtRXJyb3JcIik7XG4gICAgfVxuICAgIHJldHVybiByZXNwO1xuICB9O1xuXG5leHBvcnQgY29uc3Qgc2VuZE1lc3NhZ2VNaWRkbGV3YXJlT3B0aW9uczogSW5pdGlhbGl6ZUhhbmRsZXJPcHRpb25zID0ge1xuICBzdGVwOiBcImluaXRpYWxpemVcIixcbiAgdGFnczogW1wiVkFMSURBVEVfQk9EWV9NRDVcIl0sXG4gIG5hbWU6IFwic2VuZE1lc3NhZ2VNaWRkbGV3YXJlXCIsXG4gIG92ZXJyaWRlOiB0cnVlLFxufTtcblxuZXhwb3J0IGNvbnN0IGdldFNlbmRNZXNzYWdlUGx1Z2luID0gKGNvbmZpZzogUHJldmlvdXNseVJlc29sdmVkKTogUGx1Z2dhYmxlPGFueSwgYW55PiA9PiAoe1xuICBhcHBseVRvU3RhY2s6IChjbGllbnRTdGFjaykgPT4ge1xuICAgIGNsaWVudFN0YWNrLmFkZChzZW5kTWVzc2FnZU1pZGRsZXdhcmUoY29uZmlnKSwgc2VuZE1lc3NhZ2VNaWRkbGV3YXJlT3B0aW9ucyk7XG4gIH0sXG59KTtcbiJdfQ==